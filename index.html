<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentimiento Informado para Tatuajes - La Manuela Tattoo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
            background: linear-gradient(135deg, #1e293b 0%, #7c3aed 50%, #1e293b 100%);
            min-height: 100vh;
        }
        .glass { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
        }
        #signatureCanvas {
            border: 2px dashed #9ca3af;
            border-radius: 8px;
            cursor: crosshair;
            background: white;
        }
        .hidden { display: none; }
        .show { display: block; }
        .consent-text {
            font-size: 0.875rem;
            line-height: 1.5;
            text-align: justify;
        }
    </style>
</head>
<body>
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-5xl mx-auto">
            <!-- Header -->
            <div class="glass p-6 rounded-2xl mb-6 text-center">
                <h1 class="text-3xl font-bold text-white mb-4">CONSENTIMIENTO INFORMADO TATUAJE</h1>
                <p class="text-gray-300 text-sm mb-2">(*) Según Anexo 3 del Decreto 35/2005, de 10 de marzo, de Consejo de Gobierno, por el que se regulan las prácticas de tatuaje, micropigmentación, perforación cutánea ("piercing") u otras similares de adorno corporal.</p>
                <div class="text-gray-300 text-sm">
                    <p>Fecha: <span id="current-date"></span></p>
                </div>
            </div>

            <!-- Datos del Establecimiento -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">DATOS DEL ESTABLECIMIENTO</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Nombre/Razón Social *</label>
                        <input type="text" name="businessName" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" value="La Manuela Tattoo">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">NIF *</label>
                        <input type="text" name="businessNIF" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Nº REAC (Opcional)</label>
                        <input type="text" name="reacNumber" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Dirección *</label>
                        <input type="text" name="businessAddress" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Localidad (CP) *</label>
                        <input type="text" name="businessCity" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Teléfono *</label>
                        <input type="tel" name="businessPhone" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>
            </div>

            <!-- Datos del Aplicador -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">DATOS DEL/DE LA APLICADOR/A</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Nombre y Apellidos *</label>
                        <input type="text" name="applicatorName" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">DNI *</label>
                        <input type="text" name="applicatorDNI" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Titulación Académica/Categoría Profesional *</label>
                        <input type="text" name="applicatorQualification" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>
            </div>

            <!-- Información del Consentimiento -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">RIESGOS Y COMPLICACIONES QUE SE PUEDAN DERIVAR</h2>
                <div class="consent-text text-gray-300 space-y-4">
                    <p>Como cualquier técnica invasiva, conlleva riesgo de complicaciones que varían de leves a graves.</p>
                    <p>Todo el material utilizado se encuentra esterilizado, es de un solo uso y desechable.</p>
                    <p>El desprecintado de todo el material y su posterior eliminación se realizará en presencia del cliente.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-semibold text-white mb-2">Riesgos frecuentes:</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Enrojecimiento de la zona de aplicación</li>
                                <li>Inflamación y sangrado durante el proceso de tatuaje y posterior</li>
                                <li>Dolor en la zona de aplicación, de leve a significativo, en función de la zona tatuada</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-white mb-2">Riesgos poco frecuentes:</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Reacciones alérgicas a pigmentos de la tinta</li>
                                <li>Cicatriz hipertrófica (queloides)</li>
                                <li>Granulomas en la zona de aplicación</li>
                                <li>Infecciones de la piel</li>
                                <li>Contagio de enfermedades transmitidas por la sangre</li>
                                <li>Exposición a largo plazo a las sustancias químicas y sus productos de degradación</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-900/20 p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-300 mb-2">Recomendaciones previas:</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Si padece alguna enfermedad o está tomando algún medicamento, en especial vasodilatadores o anticoagulantes, consulte con su médico antes de iniciar la técnica</li>
                            <li>En los días previos, no tome el sol ni rayos UVA, en la zona que va a ser tatuada</li>
                            <li>No tome alcohol, bebidas excitantes (café, té, refrescos con cafeína, taurina, teína) o sustancias con componentes excitantes, así como marisco, comidas picantes y/o copiosas antes de realización de la técnica</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Cuidados Posteriores -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">CUIDADOS GENERALES POSTERIORES A LA APLICACIÓN DE TATUAJE</h2>
                <div class="consent-text text-gray-300 space-y-4">
                    <p>La práctica del tatuaje produce pequeñas heridas sobre la piel y deben tratarse como tal.</p>
                    <ul class="list-disc list-inside space-y-2">
                        <li>Limpie la zona suavemente con agua y jabón con pH neutro dos/tres veces al día</li>
                        <li>Aplique frío seco (tiempo máximo cinco minutos) si existe inflamación los primeros días</li>
                        <li>Evite el contacto con medicamentos tópicos, alcoholes, cosméticos (cremas, maquillajes, etc) y polvo</li>
                        <li>Mantenga seca la zona evitando el exceso de sudor, el tiempo bajo la ducha, sauna, piscina y/o playa</li>
                        <li>Evite agresiones sobre la zona como roces, golpes o cualquier acción que pueda dañar o irritar la piel donde se ha realizado el tatuaje, así como rascar, frotar o quitar la costra de la zona tatuada</li>
                        <li>Evite tomar sol y/o rayos UVA durante dos meses posteriores al tratamiento. Esta exposición puede variar el color del pigmento aplicado. En caso de que haya exposición solar debe utilizar protector solar (pantalla total) en la zona del tatuaje</li>
                    </ul>
                    <div class="bg-red-900/20 p-4 rounded-lg">
                        <p><strong>IMPORTANTE:</strong> Durante cuatro meses después de la aplicación de un tatuaje no podrá donar sangre.</p>
                    </div>
                    <div class="bg-blue-900/20 p-4 rounded-lg">
                        <p><strong>DEBERÁ CONSULTAR CON SU MÉDICO SI DESPUÉS DE LA APLICACIÓN DE LA TÉCNICA APARECIESE CUALQUIER COMPLICACIÓN/REACCIÓN/ALTERACIÓN DE LA PIEL SIGNIFICATIVA.</strong></p>
                    </div>
                </div>
            </div>

            <!-- Duración y Eliminación -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">DURACIÓN DEL EFECTO COLORANTE Y ELIMINACIÓN DEL TATUAJE (REVERSIBILIDAD)</h2>
                <div class="consent-text text-gray-300 space-y-4">
                    <p>El tatuaje es una técnica <strong>PERMANENTE</strong>. El paso del tiempo puede suponer una alteración o decoloración de la zona en la que se aplicó la técnica.</p>
                    <p>La tinta se deposita en capas profundas de la piel por lo que su posterior eliminación, mediante láser u otras técnicas, debe realizarse en centros sanitarios bajo supervisión médica.</p>
                </div>
            </div>

            <!-- Contraindicaciones -->
            <div class="glass p-6 rounded-2xl mb-6">
                <h2 class="text-xl font-semibold text-white mb-4">CONTRAINDICACIONES</h2>
                <div class="consent-text text-gray-300 space-y-4">
                    <p>La aplicación de tatuajes tiene contraindicaciones de carácter temporal o absoluto. Consulte a su médico si tiene alguna duda.</p>
                    <p>De manera general, <strong>NO debe realizarse técnicas de arte corporal (tatuaje) si:</strong></p>
                    <ul class="list-disc list-inside space-y-2">
                        <li>Sufre algún tipo de alergia a alguno de los productos utilizados</li>
                        <li>Sufre algún tipo de enfermedad grave que afecte a su sistema inmunológico o hematológico</li>
                        <li>Tiene lunares/manchas, verrugas, dermatitis, acné, psoriasis, liquen, queloides, angiomas engrosados, impétigo, urticaria, cloasma y melanomas u otro tipo de cáncer de piel</li>
                        <li>Sufre algún tipo de enfermedad cardiaca o lleva marcapasos</li>
                    </ul>
                    <div class="bg-orange-900/20 p-4 rounded-lg">
                        <p><strong>IMPORTANTE:</strong> La presencia de un tatuaje en determinadas zonas corporales, si no se encuentra cicatrizado y sano, puede resultar una contraindicación para la aplicación de determinadas técnicas anestésicas (epidural o raquianestesia) y/o exploraciones radiológicas (resonancia magnética).</p>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <form id="consent-form" class="space-y-6">
                <!-- Datos del Cliente -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">DATOS DEL CLIENTE</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Nombre y Apellidos *</label>
                            <input type="text" name="fullName" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Fecha de nacimiento *</label>
                            <input type="date" name="birthDate" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">DNI *</label>
                            <input type="text" name="dni" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Teléfono de contacto *</label>
                            <input type="tel" name="phone" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Representante Legal -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">REPRESENTANTE LEGAL</h2>
                    <p class="text-gray-300 text-sm mb-4">(cumplimentar en caso de menores de edad no emancipados e incapaces)</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Nombre y Apellidos del tutor legal</label>
                            <input type="text" name="legalRepresentativeName" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Fecha de nacimiento</label>
                            <input type="date" name="legalRepresentativeBirthDate" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">DNI</label>
                            <input type="text" name="legalRepresentativeDNI" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Teléfono de contacto</label>
                            <input type="tel" name="legalRepresentativePhone" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Emergency Contact -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">Contacto de Emergencia</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Nombre del contacto</label>
                            <input type="text" name="emergencyContact" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Teléfono del contacto</label>
                            <input type="tel" name="emergencyPhone" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Prueba de Sensibilidad -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">PRUEBA DE SENSIBILIDAD CUTÁNEA PREVIA AL TRATAMIENTO</h2>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="sensitivityTest" value="si" class="mr-2">
                            <span class="text-gray-300">SÍ</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="sensitivityTest" value="no" class="mr-2">
                            <span class="text-gray-300">NO</span>
                        </label>
                    </div>
                </div>

                <!-- Información del Tatuaje - Aplicador -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">ES OBLIGATORIO QUE EL/LA APLICADOR/A RELLENE ESTE APARTADO</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">LOCALIZACIÓN ANATÓMICA TATUAJE *</label>
                            <input type="text" name="tattooLocation" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Ej: Brazo derecho, espalda, etc.">
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium text-white mb-3">TINTAS EMPLEADAS</h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Nº AEMPS</label>
                                        <input type="text" name="ink1_aemps" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">LOTE</label>
                                        <input type="text" name="ink1_lote" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">COLOR</label>
                                        <input type="text" name="ink1_color" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">FECHA CAD</label>
                                        <input type="date" name="ink1_cad" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Nº AEMPS</label>
                                        <input type="text" name="ink2_aemps" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">LOTE</label>
                                        <input type="text" name="ink2_lote" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">COLOR</label>
                                        <input type="text" name="ink2_color" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">FECHA CAD</label>
                                        <input type="date" name="ink2_cad" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">Nº AEMPS</label>
                                        <input type="text" name="ink3_aemps" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">LOTE</label>
                                        <input type="text" name="ink3_lote" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">COLOR</label>
                                        <input type="text" name="ink3_color" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2">FECHA CAD</label>
                                        <input type="date" name="ink3_cad" class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Declaración de Consentimiento -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">DECLARACIÓN Y REVOCACIÓN DE ESTE CONSENTIMIENTO INFORMADO (CLIENTE/REPRESENTANTE LEGAL)</h2>
                    <div class="consent-text text-gray-300 space-y-4">
                        <p>Este documento es suscrito para que la persona usuaria o quien represente a la misma, preste su consentimiento para ser sometida a la siguiente técnica de decoración corporal.</p>
                        
                        <p>Yo, D/DÑA <input type="text" name="clientName" required class="inline-block w-64 px-2 py-1 mx-2 rounded bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Nombre completo"> manifiesto que he sido informado/a de forma satisfactoria, qué es y cómo se realiza el procedimiento. También se me ha informado los riesgos existentes, las posibles molestias y/o complicaciones de dicho procedimiento.</p>
                        
                        <p>He comprendido perfectamente todo lo anterior, he podido aclarar todas las dudas planteadas y doy</p>
                        
                        <div class="text-center my-6">
                            <div class="bg-purple-900/30 p-4 rounded-lg border-2 border-purple-500">
                                <p class="text-xl font-bold text-purple-300">CONSENTIMIENTO PARA LA APLICACIÓN DE LA TÉCNICA CITADA</p>
                            </div>
                        </div>
                        
                        <p>Se me ha notificado que tengo derecho a revocar el presente documento en cualquier momento, sin necesidad de expresar motivación alguna.</p>
                    </div>
                </div>

                <!-- Fecha y Lugar -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">FECHA Y LUGAR</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Lugar *</label>
                            <input type="text" name="place" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Ciudad">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Fecha *</label>
                            <input type="date" name="signatureDate" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Firmas -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">FECHA Y FIRMA</h2>
                    <div class="space-y-8">
                        <!-- Firma del Cliente -->
                        <div>
                            <h3 class="text-lg font-medium text-white mb-3">FIRMA DEL CLIENTE/REPRESENTANTE LEGAL</h3>
                            <canvas id="signatureCanvas" width="100%" height="200"></canvas>
                            <div class="flex gap-2 mt-2">
                                <button type="button" id="clear-signature" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">Limpiar Firma</button>
                                <p class="text-sm text-gray-300 flex-1">Firme en el área de arriba para completar el consentimiento</p>
                            </div>
                        </div>
                        
                        <!-- Firma del Aplicador -->
                        <div>
                            <h3 class="text-lg font-medium text-white mb-3">FIRMA DEL/DE LA APLICADOR/A</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Nombre del Aplicador *</label>
                                    <input type="text" name="applicatorSignatureName" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">DNI *</label>
                                    <input type="text" name="applicatorSignatureDNI" required class="w-full px-4 py-3 rounded-lg bg-black/30 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Protección de Datos -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-xl font-semibold text-white mb-4">PROTECCIÓN DE DATOS</h2>
                    <div class="consent-text text-gray-300 space-y-4">
                        <p><strong>Responsable de tratamiento:</strong> [Incluir nombre del profesional o denominación social del responsable, NIF y domicilio social].</p>
                        <p><strong>Contacto DPD:</strong> [en caso de que se disponga de DPD, identificar medio de contacto].</p>
                        <p><strong>Finalidad:</strong> gestión de la relación contractual y cumplimiento de obligación legal de aplicación al responsable.</p>
                        <p><strong>Legitimación:</strong> art. 6.1. b) y c) RGPD.</p>
                        <p><strong>Conservación:</strong> con carácter general, los datos se conservarán durante el tiempo que resulte necesario en cumplimiento de los distintos plazos de prescripción que resulten de aplicación.</p>
                        <p><strong>Destinatarios:</strong> no se prevé salvo que se requiera en atención a cumplimiento de una obligación legal.</p>
                        <p><strong>Ejercicio de derechos:</strong> el interesado puede ejercitar los derechos de acceso, rectificación, supresión, oposición, limitación del tratamiento y portabilidad, cuando sean aplicables, mediante comunicación escrita en la que concrete su solicitud dirigida al domicilio del responsable/ mediante correo electrónico dirigido a: [identificar dirección de correo electrónico si se habilita este medio] acompañando su DNI o documento equivalente.</p>
                        <p>Le informamos de la posibilidad de presentar una reclamación ante la Autoridad de Control (Agencia Española de Protección de Datos - www.aepd.es).</p>
                        <div class="bg-blue-900/20 p-4 rounded-lg">
                            <p class="text-center font-semibold">UNA COPIA ES PARA EL ESTABLECIMIENTO Y OTRA PARA EL CLIENTE</p>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="glass p-6 rounded-2xl text-center">
                    <button type="submit" id="submit-btn" class="w-full px-8 py-4 rounded-lg font-semibold text-lg transition-colors bg-gray-600 cursor-not-allowed text-gray-400">
                        Enviar Consentimiento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let signature = '';
        let isDrawing = false;

        // Signature functionality
        function initSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;

            // Signature events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);

            // Clear signature
            document.getElementById('clear-signature').addEventListener('click', clearSignature);
        }

        function startDrawing(e) {
            isDrawing = true;
            const canvas = e.target;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const canvas = e.target;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const ctx = canvas.getContext('2d');
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            isDrawing = false;
            const canvas = document.getElementById('signatureCanvas');
            signature = canvas.toDataURL();
            updateSubmitButton();
        }

        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            signature = '';
            updateSubmitButton();
        }

        // Update submit button state
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            const clientName = document.querySelector('input[name="clientName"]');
            const isClientNameFilled = clientName ? clientName.value.trim() !== '' : false;
            
            if (signature && isClientNameFilled) {
                submitBtn.className = 'w-full px-8 py-4 rounded-lg font-semibold text-lg transition-colors bg-purple-600 hover:bg-purple-700 text-white';
                submitBtn.disabled = false;
            } else {
                submitBtn.className = 'w-full px-8 py-4 rounded-lg font-semibold text-lg transition-colors bg-gray-600 cursor-not-allowed text-gray-400';
                submitBtn.disabled = true;
            }
        }

        // Add event listener for client name field
        function initClientNameField() {
            const clientNameField = document.querySelector('input[name="clientName"]');
            if (clientNameField) {
                clientNameField.addEventListener('input', updateSubmitButton);
            }
        }

        // Handle form submission
        async function handleSubmit(e) {
            e.preventDefault();
            
            if (!signature) {
                alert('Por favor firma el formulario');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.textContent = 'Enviando...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(e.target);
                const clientData = Object.fromEntries(formData.entries());
                
                // Try to submit to Railway
                const response = await fetch('https://lmtt-saas-production-2009.up.railway.app/api/consents/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        token: 'manual-submission',
                        clientData: clientData,
                        signatureData: signature,
                        ipAddress: 'unknown',
                        userAgent: navigator.userAgent
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('¡Consentimiento enviado correctamente! Gracias por completar el formulario.');
                    // Reset form
                    e.target.reset();
                    clearSignature();
                } else {
                    alert('Consentimiento guardado localmente. Los datos se procesarán cuando el sistema esté disponible.');
                    // Reset form
                    e.target.reset();
                    clearSignature();
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                alert('Consentimiento guardado localmente. Los datos se procesarán cuando el sistema esté disponible.');
                // Reset form
                e.target.reset();
                clearSignature();
            } finally {
                submitBtn.textContent = 'Enviar Consentimiento';
                updateSubmitButton();
            }
        }

        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const dateString = now.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-date').textContent = dateString;
        }

        // Auto-calculate age from birth date
        function calculateAge() {
            const birthDate = document.querySelector('input[name="birthDate"]');
            const ageInput = document.querySelector('input[name="age"]');
            
            if (birthDate && ageInput) {
                birthDate.addEventListener('change', function() {
                    if (this.value) {
                        const today = new Date();
                        const birth = new Date(this.value);
                        let age = today.getFullYear() - birth.getFullYear();
                        const monthDiff = today.getMonth() - birth.getMonth();
                        
                        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                            age--;
                        }
                        
                        ageInput.value = age;
                    }
                });
            }
        }

        // Initialize the form
        document.addEventListener('DOMContentLoaded', function() {
            setCurrentDate();
            initSignature();
            calculateAge();
            initClientNameField();
            document.getElementById('consent-form').addEventListener('submit', handleSubmit);
        });
    </script>
</body>
</html>
